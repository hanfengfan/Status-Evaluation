import{I as D,r as a,a as I,p as h,w as x}from"./index-DznQeGOr.js";import{b as C,s as o}from"./powerEvaluationConfig-qHJ1IN5O.js";const v="urban-rail-devices",k=()=>{if(typeof window>"u")return[...o];try{const n=window.localStorage.getItem(v);if(!n)return[...o];const s=JSON.parse(n);return s.length?s:[...o]}catch(n){return console.error("加载设备数据失败",n),[...o]}},L=D("device",()=>{var l;const n=a(C),s=a(k()),i=I({keyword:"",status:"全部",category:"全部"}),c=a(((l=n.value[0])==null?void 0:l.id)??""),f=h(()=>s.value.filter(e=>{if(e.systemId!==c.value||i.status!=="全部"&&e.status!==i.status||i.category!=="全部"&&e.category!==i.category)return!1;if(i.keyword){const t=i.keyword.trim().toLowerCase();return e.name.toLowerCase().includes(t)||e.code.toLowerCase().includes(t)||e.location.toLowerCase().includes(t)}return!0})),w=e=>{c.value=e,n.value.find(r=>r.id===e)&&(i.category="全部")},d=e=>{s.value.push(e)},m=(e,t)=>{const r=s.value.findIndex(u=>u.id===e);r!==-1&&(s.value[r]={...s.value[r],...t})},y=e=>{const t=s.value.findIndex(r=>r.id===e.id);t===-1?d(e):s.value[t]={...s.value[t],...e}},S=e=>{s.value=s.value.filter(t=>t.id!==e)},g=(e,t)=>{const r=s.value.find(u=>u.id===e);r&&(r.status=t)},p=e=>{const t=s.value.find(r=>r.id===e.id);t&&(t.score=e.score,t.status=e.level==="A"?"正常":e.level==="B"?"关注":e.level==="C"?"预警":"严重",t.lastEvalAt=e.evaluatedAt)};if(typeof window<"u"){let e=null;const t=()=>{e!==null&&window.clearTimeout(e),e=window.setTimeout(()=>{window.localStorage.setItem(v,JSON.stringify(s.value)),e=null},120)};x(s,()=>{t()},{deep:!0})}return{systems:n,devices:s,filter:i,currentSystemId:c,filteredDevices:f,setSystem:w,addDevice:d,upsertDevice:y,updateDevice:m,removeDevice:S,setDeviceStatus:g,recordEvaluation:p}});export{L as u};
